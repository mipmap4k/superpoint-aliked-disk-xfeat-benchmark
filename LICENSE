# UAV Visual Navigation Benchmark (SuperPoint, ALIKED, DISK, XFeat)

**Инструмент для сравнительного анализа (бенчмаркинга) моделей поиска и сопоставления ключевых точек (Feature Matching) на парах изображений «Дрон — Спутник».**

Проект оценивает устойчивость современных локальных дескрипторов в задачах визуальной навигации, где присутствуют изменения масштаба, вращение и перспективные искажения.

## Поддерживаемые модели

Бенчмарк «из коробки» поддерживает следующие архитектуры:
*   **SuperPoint** + LightGlue
*   **ALIKED** + LightGlue
*   **DISK** + LightGlue
*   **XFeat** (Accelerated Features) + LighterGlue

## Алгоритм работы бенчмарка

Скрипт `benchmark.py` реализует следующий пайплайн обработки для каждой пары изображений:

1.  **Загрузка данных (`DataProvider`):**
    *   Получает пару изображений (Спутник, Дрон) и метаданные.
    *   Класс `DataProvider` (внешний модуль) отвечает за нарезку и геопривязку спутниковой карты.

2.  **Препроцессинг:**
    *   Изображения приводятся к единой ширине **1024px** с сохранением пропорций.
    *   Нормализация цветов (0-1) и конвертация в тензоры PyTorch.

3.  **Инференс моделей:**
    *   **LightGlue-based (SP, ALIKED, DISK):** Используется библиотека `lightglue`. Извлекается до **1024** ключевых точек.
    *   **XFeat:** Загружается через `torch.hub`. Используется встроенный облегченный матчер.

4.  **Геометрическая верификация (`GeometryVerifier`):**
    *   Найденные соответствия (matches) проверяются на геометрическую согласованность.
    *   Используется поиск гомографии методом **USAC_MAGSAC** (современная, более точная версия RANSAC) с порогом ошибки **3.0 px**.
    *   Матчи разделяются на *Inliers* (верные) и *Outliers* (шум).

5.  **Расчет метрик (`MetricsCalculator`):**
    *   **Inlier Count:** Количество геометрически подтвержденных совпадений.
    *   **mAP (mean Average Precision):** Оценивает качество ранжирования матчей по уверенности (confidence) модели.

6.  **Визуализация и Аналитика:**
    *   Для **каждого** кадра генерируется детальный отчет (см. ниже).
    *   В конце формируется сводный график (`boxplot`) распределения стабильности метрик по всему датасету.

## Структура проекта

```text
.
├── UAV_dataset/                   # Корневая папка с данными
│   ├── DCIM_1/                    # Данные полета 1
│   │   ├── 100MSDCF/              # Фотографии с дрона + telemetry.csv
│	│	│	├── ..._001.JPG 
│	│	│	├── ..._002.JPG 
│	│	│	├── ...
│	│	│	└── ..._telemetry.csv
│   │   └── GCS/                   
│	│	│	└── map.tif            # Спутниковая карта GeoTIFF
│   └── DCIM_2/                    # Данные полета 2
│       ├── ...
├── benchmark.py                   # Основная программа бенчмарка
├── DataProvider.py                # Класс генерации пар изображений и обработки │                                    геоданных
├── requirements.txt               # Зависимости проекта
└── save_maps_script.py            # Вспомогательный скрипт для визуальной                                            проверки работы DataProvider
```


## Выходные данные (Visualization)

Бенчмарк генерирует богатую визуализацию в папке `vis_results`. Для каждой пары изображений создается PNG-файл, содержащий:

1.  **Спутниковая карта:** Отображены все найденные точки (красные) и подтвержденные инлайеры (зеленые). Размер точек зависит от уверенности модели.
2.  **Снимок дрона:** Отображены только подтвержденные инлайеры.
3.  **Гистограмма уверенности (Confidence):** Распределение уверенности модели для всех матчей vs инлайеров.
4.  **Гистограмма очков (Matching Score):** Насколько сильно дескрипторы похожи друг на друга.

##  Установка и запуск

### 1. Установка зависимостей

```bash
pip install -r src/requirements.txt
```

*Примечание: Библиотека `lightglue` должна быть установлена (или склонирована в папку проекта).*

### 2. Запуск

Убедитесь, что ваш `DataProvider.py` и папка с датасетом находятся рядом.

```bash
python benchmark.py
```

### Конфигурация
Внутри `benchmark.py` (блок `__main__`) можно настроить:
*   `DATASET_PATH`: Путь к данным.
*   `DEVICE`: 'cuda' или 'cpu' (определяется автоматически).
*   `vis_scale`: Размер точек на визуализации (по умолчанию 45).

## Результаты (Пример вывода в консоль)

```text
Запуск: SUPERPOINT
  [1] Processed frame_1 | Inliers: 145
  [2] Processed frame_2 | Inliers: 132
...

Запуск: XFEAT
  [1] Processed frame_1 | Inliers: 156
...

==================================================
Algorithm       | mAP        | Avg Inliers
--------------------------------------------------
SUPERPOINT      | 0.8540     | 138.5
ALIKED          | 0.8120     | 120.2
DISK            | 0.7900     | 115.0
XFEAT           | 0.8800     | 150.1
==================================================
Финальный отчет сохранен в: vis_results/summary_report
```

MIT License

Copyright (c) 2026 mipmap4k

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
